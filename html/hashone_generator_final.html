<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hash-One Generator</title>
    <style>
            body {
                font-family: Arial, sans-serif;
                line-height: 1.6;
                margin: 0;
                padding: 0;
                background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                color: #333;
                display: flex;
                flex-direction: column;
                min-height: 100vh;
            }

            /* Navigation Header */
            .nav-header {
                background: rgba(255, 255, 255, 0.1);
                backdrop-filter: blur(10px);
                border-bottom: 1px solid rgba(255, 255, 255, 0.2);
                padding: 1rem 0;
                position: sticky;
                top: 0;
                z-index: 100;
            }

            .nav-container {
                max-width: 1200px;
                margin: 0 auto;
                display: flex;
                justify-content: center;
                align-items: center;
                padding: 0 2rem;
            }

            .nav-links {
                display: flex;
                gap: 2rem;
                list-style: none;
                margin: 0;
                padding: 0;
            }

            .nav-links a {
                color: white;
                text-decoration: none;
                padding: 0.5rem 1rem;
                border-radius: 25px;
                transition: all 0.3s ease;
                font-weight: 500;
                background: rgba(255, 255, 255, 0.1);
            }

            .nav-links a:hover {
                background: rgba(255, 255, 255, 0.2);
                transform: translateY(-2px);
                box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
            }

            .nav-links a.active {
                background: rgba(255, 255, 255, 0.3);
                font-weight: bold;
            }

header {
    background: rgba(51, 51, 51, 0.9);
    backdrop-filter: blur(10px);
    color: white;
    padding: 2rem;
    text-align: center;
    position: relative;
    box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);

    /* New CSS for vertical centering */
    display: flex;
    justify-content: center;
    align-items: center;
    flex-direction: column;
}

.avv {
    /* Use absolute positioning to place the logo on the left */
    position: absolute;
    top: 50%; /* Position from the top, pushing the element's top edge to the vertical center */
    left: 30px;
    transform: translateY(-50%); /* Pull the element up by half its height to perfectly center it */
    width: 200px;
    height: auto;
}

.cys {
    /* Use absolute positioning to place the logo on the right */
    position: absolute;
    top: 50%; /* Position from the top, pushing the element's top edge to the vertical center */
    right: 50px;
    transform: translateY(-50%); /* Pull the element up by half its height to perfectly center it */
    width: 100px;
    height: auto;
}

/* Also update the responsive design for mobile views */
@media (max-width: 768px) {
    .avv, .cys {
        position: static;
        display: block;
        margin: 0 auto 10px;
        width: 100px; /* Adjust width for mobile view */
        transform: none; /* Remove the translateY for mobile view */
    }
    
    header {
        flex-direction: column; /* Ensure elements stack vertically */
    }

    header h1 {
        margin-top: 10px; /* Add some space after the logos in the mobile view */
        font-size: 1.5em;
    }
}
            main {
                display: flex;
                justify-content: center;
                align-items: flex-start;
                flex-grow: 1;
                padding: 2rem 0;
            }

            .container {
                display: flex;
                gap: 30px;
                flex-wrap: wrap;
                justify-content: center;
                max-width: 1200px;
                width: 90%;
            }

            .section {
                background: rgba(255, 255, 255, 0.95);
                backdrop-filter: blur(10px);
                width: 450px;
                padding: 2rem;
                border-radius: 20px;
                box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
                margin: 10px;
                display: flex;
                flex-direction: column;
                transition: transform 0.3s ease, box-shadow 0.3s ease;
            }

            .section:hover {
                transform: translateY(-5px);
                box-shadow: 0 25px 50px rgba(0, 0, 0, 0.15);
            }

            .section h2 {
                color: #007bff;
                text-align: center;
                margin-top: 0;
                margin-bottom: 1.5rem;
                font-size: 1.8em;
                border-bottom: 3px solid #007bff;
                padding-bottom: 0.5rem;
            }

            .section label {
                margin-bottom: 8px;
                font-weight: bold;
                color: #333;
                font-size: 1.1em;
            }

            .section input[type="file"], 
            .section input[type="text"] {
                margin-bottom: 15px;
                padding: 12px;
                border: 2px solid #ddd;
                border-radius: 10px;
                font-size: 14px;
                transition: border-color 0.3s ease, box-shadow 0.3s ease;
            }

            .section input[type="file"]:focus,
            .section input[type="text"]:focus {
                border-color: #007bff;
                box-shadow: 0 0 10px rgba(0, 123, 255, 0.2);
                outline: none;
            }

            .section input[type="text"] {
                width: 100%;
                box-sizing: border-box;
            }

            .button {
                background: linear-gradient(135deg, #007bff, #0056b3);
                color: #fff;
                border: none;
                padding: 15px 20px;
                border-radius: 25px;
                cursor: pointer;
                width: 100%;
                box-shadow: 0 8px 25px rgba(0, 123, 255, 0.3);
                transition: all 0.3s ease;
                font-size: 16px;
                font-weight: bold;
                text-transform: uppercase;
                letter-spacing: 1px;
            }

            .button:hover {
                background: linear-gradient(135deg, #0056b3, #004494);
                transform: translateY(-2px);
                box-shadow: 0 12px 30px rgba(0, 123, 255, 0.4);
            }

            .button:active {
                transform: translateY(0);
            }

            .note-box {
                background: linear-gradient(135deg, #fff3cd, #ffeaa7);
                color: #856404;
                border: 2px solid #ffeeba;
                padding: 1.5rem;
                border-radius: 15px;
                margin-bottom: 1.5rem;
                text-align: left;
                box-shadow: 0 8px 20px rgba(255, 193, 7, 0.2);
            }

            .hash-output-container {
                word-wrap: break-word;
                max-height: 200px;
                overflow-y: auto;
                background: linear-gradient(135deg, #f8f9fa, #e9ecef);
                border: 2px solid #ccc;
                padding: 15px;
                margin-top: 15px;
                border-radius: 10px;
                font-family: 'Courier New', monospace;
                font-size: 12px;
                line-height: 1.4;
                box-shadow: inset 0 4px 10px rgba(0, 0, 0, 0.1);
            }

            footer {
                background: rgba(51, 51, 51, 0.9);
                backdrop-filter: blur(10px);
                color: white;
                text-align: center;
                padding: 2rem 0;
                margin-top: auto;
            }

            /* Modal styles - Enhanced */
            .modal {
                display: none;
                position: fixed;
                z-index: 1000;
                left: 0;
                top: 0;
                width: 100%;
                height: 100%;
                overflow: auto;
                background-color: rgba(0, 0, 0, 0.6);
                backdrop-filter: blur(5px);
                align-items: center;
                justify-content: center;
            }

            .modal-content {
                background: rgba(255, 255, 255, 0.95);
                backdrop-filter: blur(10px);
                padding: 2.5rem;
                border-radius: 20px;
                width: 85%;
                max-width: 700px;
                position: relative;
                text-align: center;
                box-shadow: 0 25px 50px rgba(0, 0, 0, 0.3);
                animation: modalSlideIn 0.3s ease-out;
            }

            @keyframes modalSlideIn {
                from {
                    opacity: 0;
                    transform: translateY(-50px);
                }
                to {
                    opacity: 1;
                    transform: translateY(0);
                }
            }

            .close-button {
                color: #aaa;
                position: absolute;
                top: 15px;
                right: 20px;
                font-size: 28px;
                font-weight: bold;
                cursor: pointer;
                transition: color 0.3s ease;
                padding: 5px;
                border-radius: 50%;
            }

            .close-button:hover,
            .close-button:focus {
                color: #333;
                background: rgba(255, 0, 0, 0.1);
            }

            #dialogMessage {
                font-size: 1.3em;
                font-weight: bold;
                margin-bottom: 20px;
                color: #333;
            }

            .dialog-buttons {
                margin-top: 20px;
                display: flex;
                justify-content: center;
                gap: 15px;
                flex-wrap: wrap;
            }

            .dialog-button {
                width: auto;
                padding: 12px 24px;
                min-width: 120px;
                font-size: 14px;
            }

            /* Throbber/Spinner styles - Enhanced */
            .throbber-overlay {
                display: none;
                position: fixed;
                z-index: 2000;
                left: 0;
                top: 0;
                width: 100%;
                height: 100%;
                background-color: rgba(0, 0, 0, 0.7);
                backdrop-filter: blur(5px);
                justify-content: center;
                align-items: center;
            }

            .spinner-container {
                text-align: center;
                color: white;
            }

            .spinner {
                border: 8px solid rgba(255, 255, 255, 0.3);
                border-top: 8px solid #007bff;
                border-radius: 50%;
                width: 80px;
                height: 80px;
                animation: spin 1s linear infinite;
                margin: 0 auto 20px;
            }

            @keyframes spin {
                0% { transform: rotate(0deg); }
                100% { transform: rotate(360deg); }
            }

            .spinner-text {
                font-size: 1.2em;
                font-weight: bold;
            }

            /* Instructions Modal */
            .instructions-modal {
                display: flex;
                position: fixed;
                z-index: 3000;
                left: 0;
                top: 0;
                width: 100%;
                height: 100%;
                background-color: rgba(0, 0, 0, 0.8);
                backdrop-filter: blur(5px);
                align-items: center;
                justify-content: center;
            }

            .instructions-content {
                background: rgba(255, 255, 255, 0.98);
                backdrop-filter: blur(15px);
                padding: 3rem;
                border-radius: 25px;
                width: 90%;
                max-width: 800px;
                max-height: 80vh;
                overflow-y: auto;
                text-align: left;
                box-shadow: 0 30px 60px rgba(0, 0, 0, 0.4);
                animation: modalSlideIn 0.4s ease-out;
            }

            .instructions-content h2 {
                color: #007bff;
                text-align: center;
                margin-bottom: 1.5rem;
                font-size: 2em;
                border-bottom: 3px solid #007bff;
                padding-bottom: 0.5rem;
            }

            .instructions-section {
                margin-bottom: 2rem;
                padding: 1.5rem;
                background: rgba(248, 249, 250, 0.8);
                border-radius: 15px;
                border-left: 5px solid #007bff;
            }

            .instructions-section h3 {
                color: #0056b3;
                margin-top: 0;
                font-size: 1.3em;
            }

            .instructions-list {
                margin: 10px 0;
                padding-left: 20px;
            }

            .instructions-list li {
                margin-bottom: 8px;
                line-height: 1.5;
            }

            /* Verification result styling */
            #verifyvalue {
                padding: 15px;
                border-radius: 10px;
                text-align: center;
                font-weight: bold;
                margin-top: 15px;
                font-size: 1.1em;
            }

            .verify-success {
                background: linear-gradient(135deg, #d4edda, #c3e6cb);
                color: #155724;
                border: 2px solid #c3e6cb;
            }

            .verify-error {
                background: linear-gradient(135deg, #f8d7da, #f5c6cb);
                color: #721c24;
                border: 2px solid #f5c6cb;
            }

            /* Responsive design */
            @media (max-width: 768px) {
                .container {
                    flex-direction: column;
                    align-items: center;
                    width: 95%;
                }
                
                .section {
                    width: 100%;
                    max-width: 500px;
                    padding: 1.5rem;
                }
                
                .avv {
                    position: absolute;
                    display: block;
                    margin: 0 auto 10px;
                    width: 200px;
                }
                .cys {
                    position: static;
                    display: block;
                    margin: 0 auto 10px;
                    width: 100px;
                }
                
                header h1 {
                    font-size: 1.5em;
                    margin-top: 20px;
                }
                
                .nav-links {
                    flex-direction: column;
                    gap: 0.5rem;
                    text-align: center;
                }
                
                .modal-content, .instructions-content {
                    width: 95%;
                    padding: 1.5rem;
                    margin: 10px;
                }
                
                .dialog-buttons {
                    flex-direction: column;
                    align-items: center;
                }
                
                .dialog-button {
                    width: 80%;
                    margin-bottom: 5px;
                }
            }
        </style>
</head>
<body>
    <!-- Instructions Modal (shown on page load) -->
    <div id="instructionsModal" class="instructions-modal">
        <div class="instructions-content">
            <span class="close-button" onclick="closeInstructions()">&times;</span>
            <h2>üõ°Ô∏è Hash-One Generator Instructions</h2>
            
            <div class="instructions-section">
                <h3>üìù How to Use This Tool</h3>
                <p>This Hash-One generator is divided into two main sections:</p>
            </div>

            <div class="instructions-section">
                <h3>üèóÔ∏è Generator Section</h3>
                <ul class="instructions-list">
                    <li><strong>Upload File:</strong> Click "Choose File" to select any file you want to hash</li>
                    <li><strong>Generate Hash:</strong> Click "Generate Hash" to create the Hash-One cryptographic hash</li>
                    <li><strong>View Results:</strong> The hash will be displayed in binary format with options to convert to hexadecimal</li>
                    <li><strong>Copy Hash:</strong> Use the copy button to save the hash for verification later</li>
                </ul>
            </div>

            <div class="instructions-section">
                <h3>‚úÖ Verifier Section</h3>
                <ul class="instructions-list">
                    <li><strong>Enter Hash:</strong> Paste the hash value you want to verify (binary or hexadecimal format)</li>
                    <li><strong>Select Same File:</strong> Make sure to select the exact same file used for generation</li>
                    <li><strong>Click Verify:</strong> The tool will compare the entered hash with a newly generated hash</li>
                    <li><strong>Results:</strong> Green message = File is authentic, Red message = File may be corrupted</li>
                </ul>
            </div>

            <div class="note-box">
                <strong>‚ö†Ô∏è Important Notes:</strong><br>
                ‚Ä¢ This implementation processes files bit-by-bit in the browser<br>
                ‚Ä¢ Best suited for smaller files (less than 100 KB)<br>
                ‚Ä¢ Larger files may cause browser unresponsiveness<br>
                ‚Ä¢ This is a proof-of-concept for educational purposes<br>
                ‚Ä¢ Hash-One provides 80-bit security with 160-bit output
            </div>

            <div style="text-align: center; margin-top: 2rem;">
                <button class="button" onclick="closeInstructions()" style="width: auto; padding: 12px 30px;">
                    üöÄ Start Using Hash-One
                </button>
            </div>
        </div>
    </div>

    <!-- Navigation Header -->
    <div class="nav-header">
        <div class="nav-container">
            <ul class="nav-links">
                <li><a href="../index.html">üè† Introduction</a></li>
                <li><a href="#" class="active">üîß Generator Tool</a></li>
                <li><a href="../index.html#about">‚ÑπÔ∏è About Us</a></li>
            </ul>
        </div>
    </div>

    <header>
        <img src="../images/avv.png" class="avv" alt="AMRITA logo">
        <h1>Hash-One: A Lightweight Cryptographic Function</h1>
        <img src="../images/cys.png" class="cys" alt="CYS logo">
    </header>

    <main>
        <div class="container">
            <!-- Generator Section -->
            <div class="section generator-section">
                <h2>üîß Generator</h2>
                <div class="note-box">
                    <strong>‚ö†Ô∏è Please Note:</strong> This tool processes files bit-by-bit for Hash-One generation. For optimal performance, use files smaller than 100 KB. Larger files may cause browser unresponsiveness.
                </div>
                <form>
                    <label for="fileInput">üìÅ Upload a file (supports any file type)</label>
                    <input type="file" id="fileInput" accept="*/*" />
                    <br><br>
                    <input type="button" value="üîê Generate Hash" class="button" onclick="calculateHash()">
                </form>
            </div>

            <!-- Verifier Section -->
            <div class="section verifier-section">
                <h2>‚úÖ Verifier</h2>
                <div class="note-box">
                    <strong>üí° Verification Tip:</strong> Enter the hash value (binary or hexadecimal) and select the same file to verify its integrity using Hash-One algorithm.
                </div>
                <form>
                    <label for="Verify_hash">üîç Enter the hash value (binary or hex):</label>
                    <input type="text" name="hash" id="Verify_hash" placeholder="Enter hash in binary (0s and 1s) or hexadecimal format">
                    <br><br>
                    <input type="button" value="üîç Verify Hash" class="button" onclick="verifyHash()">
                    <div id="verifyvalue"></div>
                </form>
            </div>
        </div>
    </main>

    <!-- Throbber/Loading Spinner -->
    <div id="throbber" class="throbber-overlay">
        <div class="spinner-container">
            <div class="spinner"></div>
            <div class="spinner-text">Processing Hash-One Algorithm...</div>
        </div>
    </div>

    <!-- Modal Dialog -->
    <div id="dialog" class="modal">
        <div class="modal-content">
            <span class="close-button">&times;</span>
            <p id="dialogMessage"></p>
            <div id="dialogHash" class="hash-output-container"></div>
            <div id="dialogButtons" class="dialog-buttons">
                <button id="convertButton" class="button dialog-button">üîÑ Convert to Hex</button>
                <button id="copyButton" class="button dialog-button">üìã Copy Bits</button>
                <button id="closeDialogButton" class="button dialog-button">‚ùå Close</button>
            </div>
        </div>
    </div>

    <footer>
        <div id="footer" class="footer">
            <p>
                Copyright ¬© 2023 | Deepak Kumar S<br>
                B.Tech CSE(CYS)<br>
                Part of 20CYS202 - User Interface Design and 20CYS205 - Modern Cryptography<br>
                Amrita Vishwa Vidyapeetham, Coimbatore
            </p>
        </div>
    </footer>

    <script>
        const SPONGE_STATE_SIZE = 161;
        const P_SIZE = 80;
        const Q_SIZE = 81;

        // Modal and Throbber elements
        const dialog = document.getElementById('dialog');
        const throbber = document.getElementById('throbber');
        const instructionsModal = document.getElementById('instructionsModal');
        const closeButton = document.querySelector('.close-button');
        const closeDialogButton = document.getElementById('closeDialogButton');
        const dialogMessage = document.getElementById('dialogMessage');
        const dialogHash = document.getElementById('dialogHash');
        const convertButton = document.getElementById('convertButton');
        const copyButton = document.getElementById('copyButton');
        let currentHashValue = '';

        // Close instructions modal
        function closeInstructions() {
            instructionsModal.style.display = 'none';
        }

        // Helper function to show the modal
        function showDialog(message, hash = '') {
            dialogMessage.textContent = message;
            dialogHash.textContent = hash;
            currentHashValue = hash;
            
            if (hash) {
                convertButton.style.display = 'inline-block';
                copyButton.style.display = 'inline-block';
            } else {
                convertButton.style.display = 'none';
                copyButton.style.display = 'none';
            }
            
            // Reset copy button text
            copyButton.innerHTML = 'üìã Copy Bits';

            dialog.style.display = 'flex';
        }

        // Helper function to convert binary string to hexadecimal
        function convertToHex(binaryString) {
            let hexString = '';
            const paddedBinary = binaryString.padStart(Math.ceil(binaryString.length / 4) * 4, '0');
            for (let i = 0; i < paddedBinary.length; i += 4) {
                const chunk = paddedBinary.substring(i, i + 4);
                hexString += parseInt(chunk, 2).toString(16);
            }
            return hexString;
        }

        // Helper function to convert hex to binary
        function convertHexToBinary(hexString) {
            let binaryString = '';
            const cleanHex = hexString.startsWith('0x') ? hexString.substring(2) : hexString;
            const paddedHex = cleanHex.padStart(Math.ceil(160 / 4), '0');
            
            for (let i = 0; i < paddedHex.length; i++) {
                binaryString += parseInt(paddedHex[i], 16).toString(2).padStart(4, '0');
            }
            return binaryString.substring(0, 160);
        }

        // Generate the first 161 bits of Pi in binary
        function getPiBits() {
            const piFractional = "1415926535897932384626433832795028841971693993751058209749445923078164062862089986280348253421170679";
            
            let binary = '';
            let fraction = piFractional;
            
            for (let i = 0; i < SPONGE_STATE_SIZE; i++) {
                let carry = 0;
                let newFraction = '';
                
                for (let j = 0; j < fraction.length; j++) {
                    const digit = parseInt(fraction[j]) * 2 + carry;
                    if (digit >= 10) {
                        newFraction += (digit - 10).toString();
                        carry = 1;
                    } else {
                        newFraction += digit.toString();
                        carry = 0;
                    }
                }
                
                binary += carry.toString();
                fraction = newFraction;
                
                while (fraction.length < 100) {
                    fraction += '0';
                }
            }
            
            return binary.split('').map(bit => parseInt(bit));
        }

        // Helper function to convert a single byte to an array of 8 bits
        function byteToBits(byte) {
            const bits = [];
            for (let i = 7; i >= 0; i--) {
                bits.push((byte >> i) & 1);
            }
            return bits;
        }

        function calculateHash() {
            const fileInput = document.getElementById('fileInput');
            const file = fileInput.files[0];
            
            if (!file) {
                showDialog('‚ùå Please choose a file.');
                return;
            }

            throbber.style.display = 'flex';

            const reader = new FileReader();
            reader.onload = function (e) {
                setTimeout(() => {
                    const fileContent = new Uint8Array(e.target.result);
                    const messageBits = Array.from(fileContent).flatMap(byte => byteToBits(byte));

                    const state = getPiBits();
                    spongeConstruction(state, messageBits);

                    const hashBits = state.slice(0, 160);
                    const hashValue = hashBits.join('');

                    showDialog('üéâ Hash Generated Successfully (Binary Format):', hashValue);
                    throbber.style.display = 'none';
                }, 50);
            };

            reader.readAsArrayBuffer(file);
        }

        function verifyHash() {
            const fileInput = document.getElementById('fileInput');
            const verifyHashInput = document.getElementById('Verify_hash').value.trim();
            const verifyValueDiv = document.getElementById('verifyvalue');
            
            const file = fileInput.files[0];
            if (!file) {
                showDialog('‚ùå Please choose a file to verify.');
                return;
            }
            
            if (!verifyHashInput) {
                showDialog('‚ùå Please enter a hash value to verify.');
                return;
            }

            throbber.style.display = 'flex';

            const reader = new FileReader();
            reader.onload = function (e) {
                setTimeout(() => {
                    const fileContent = new Uint8Array(e.target.result);
                    const messageBits = Array.from(fileContent).flatMap(byte => byteToBits(byte));

                    const state = getPiBits();
                    spongeConstruction(state, messageBits);

                    const hashBits = state.slice(0, 160);
                    const rehashedValue = hashBits.join('');
                    
                    let inputAsBinary;
                    const cleanedInput = verifyHashInput.replace(/0x/i, '');
                    
                    const isBinary = /^[01]+$/.test(verifyHashInput);
                    const isHex = /^[0-9a-fA-F]+$/.test(cleanedInput);
                    
                    if (isBinary) {
                        inputAsBinary = verifyHashInput.padStart(160, '0');
                    } else if (isHex) {
                        inputAsBinary = convertHexToBinary(verifyHashInput);
                    } else {
                        verifyValueDiv.innerHTML = "‚ùå Invalid hash format. Please use binary (0s and 1s) or hexadecimal (0-9, a-f).";
                        verifyValueDiv.className = "verify-error";
                        throbber.style.display = 'none';
                        return;
                    }

                    if (rehashedValue === inputAsBinary) {
                        verifyValueDiv.innerHTML = "‚úÖ Hash matched! File is authentic and unmodified.";
                        verifyValueDiv.className = "verify-success";
                    } else {
                        verifyValueDiv.innerHTML = "‚ùå Hash verification failed! File may be corrupted or altered.";
                        verifyValueDiv.className = "verify-error";
                    }
                    throbber.style.display = 'none';
                }, 50);
            };

            reader.readAsArrayBuffer(file);
        }

        // Corrected sponge construction as per the research paper
        function spongeConstruction(state, message) {
            const k = message.length;
            
            if (k === 0) {
                updateFunction(state, 324);
                return;
            }
            
            if (k >= 1) {
                state[160] ^= message[0];
                updateFunction(state, 324);
            }
            
            for (let i = 1; i < k - 1; i++) {
                state[160] ^= message[i];
                updateFunction(state, 162);
            }
            
            if (k > 1) {
                state[160] ^= message[k - 1];
                updateFunction(state, 324);
            }
            
            const hashOutput = [];
            for (let i = 0; i < 160; i++) {
                updateFunction(state, 1);
                hashOutput.push(state[160]);
            }
            
            for (let i = 0; i < 160; i++) {
                state[i] = hashOutput[i];
            }
        }

        // Update function implementing the permutation as per research paper
        function updateFunction(state, rounds) {
            let P = state.slice(0, P_SIZE);
            let Q = state.slice(P_SIZE, SPONGE_STATE_SIZE);

            for (let r = 0; r < rounds; r++) {
                const Pf = (P[0] & P[11]) ^ (P[0] & P[55]) ^ (P[11] & Q[23]) ^ (Q[23] & P[55]) ^ Q[23] ^ P[55] ^ 1;
                const Qf = (Q[25] & P[48]) ^ (Q[25] & Q[41]) ^ (Q[0] & P[48]) ^ (Q[0] & Q[41]) ^ Q[25] ^ Q[41];
                const Lf = P[1] ^ Q[1] ^ P[50];

                const newP79 = Pf ^ Lf;
                const newQ80 = Qf ^ Lf;

                for (let i = 0; i < P_SIZE - 1; i++) {
                    P[i] = P[i + 1];
                }
                P[P_SIZE - 1] = newP79;

                for (let i = 0; i < Q_SIZE - 1; i++) {
                    Q[i] = Q[i + 1];
                }
                Q[Q_SIZE - 1] = newQ80;
            }

            for (let i = 0; i < P_SIZE; i++) {
                state[i] = P[i];
            }
            for (let i = P_SIZE; i < SPONGE_STATE_SIZE; i++) {
                state[i] = Q[i - P_SIZE];
            }
        }

        // Event listeners
        closeButton.addEventListener('click', () => {
            dialog.style.display = 'none';
        });

        closeDialogButton.addEventListener('click', () => {
            dialog.style.display = 'none';
        });

        convertButton.addEventListener('click', () => {
            dialogHash.textContent = '0x' + convertToHex(currentHashValue);
            convertButton.style.display = 'none';
            copyButton.innerHTML = 'üìã Copy Hex';
        });

        copyButton.addEventListener('click', () => {
            const textToCopy = dialogHash.textContent;
            try {
                navigator.clipboard.writeText(textToCopy).then(() => {
                    dialogMessage.textContent = '‚úÖ Copied to clipboard!';
                }).catch(() => {
                    const tempInput = document.createElement('textarea');
                    tempInput.value = textToCopy;
                    document.body.appendChild(tempInput);
                    tempInput.select();
                    document.execCommand('copy');
                    document.body.removeChild(tempInput);
                    dialogMessage.textContent = '‚úÖ Copied to clipboard!';
                });
            } catch (err) {
                const tempInput = document.createElement('textarea');
                tempInput.value = textToCopy;
                document.body.appendChild(tempInput);
                tempInput.select();
                document.execCommand('copy');
                document.body.removeChild(tempInput);
                dialogMessage.textContent = '‚úÖ Copied to clipboard!';
            }
        });

        window.addEventListener('click', (event) => {
            if (event.target === dialog) {
                dialog.style.display = 'none';
            }
        });
    </script>
</body>
</html>
